# Testing Requirements and Architecture

This document outlines the testing requirements, architecture, and approach for the BkpFile application.

## Test Categories

### Unit Tests
**Implementation**: `*_test.go` files
**Requirements**:
- `TestGenerateBackupName`: Tests backup naming
  - Validates naming format with various inputs
- `TestDefaultConfig` and `TestLoadConfig`: Tests configuration
  - Validates configuration loading and defaults
  - Tests configuration discovery with `BKPFILE_CONFIG` environment variable
  - Tests multiple configuration file precedence
  - Tests home directory expansion in paths
  - Tests status code configuration loading and defaults
  - Validates all status code fields are properly loaded from YAML
  - Tests status code configuration with custom values
- `TestGetConfigSearchPath`: Tests configuration path discovery
  - Validates environment variable parsing
  - Tests hard-coded default path when environment variable not set
  - Tests colon-separated path list parsing
  - Tests home directory expansion
- `TestDisplayConfig`: Tests configuration value display
  - Validates configuration value computation and source tracking
  - Tests environment variable processing for configuration paths
  - Tests hard-coded default path handling
  - Tests default value handling and source attribution
  - Tests output format with name, value, and source
  - Tests display of status code configuration values
  - Test cases:
    - Configuration with default values only
    - Configuration from single file
    - Configuration from multiple files with precedence
    - Configuration with missing files
    - Configuration with invalid files
    - Environment variable override scenarios
    - Status code configuration display
- `TestCopyFile`: Tests file copying
  - Validates file copying and permission preservation
- `TestCopyFileWithContext`: Tests context-aware file copying
  - Validates file copying with cancellation support
  - Test cases:
    - Successful copy with context
    - Copy cancelled via context
    - Copy with timeout
    - Copy with already cancelled context
- `TestListBackups`: Tests backup listing
  - Validates backup listing and sorting
- `TestCreateBackup`: Tests backup creation
  - Validates backup creation with various scenarios
  - Tests status code exit behavior for different conditions
  - Tests panic recovery and error handling
  - Test cases:
    - Successful backup creation (should exit with `cfg.StatusCreatedBackup`)
    - File identical to existing backup (should exit with `cfg.StatusFileIsIdenticalToExistingBackup`)
    - File not found (should exit with `cfg.StatusFileNotFound`)
    - Invalid file type (should exit with `cfg.StatusInvalidFileType`)
    - Permission denied (should exit with `cfg.StatusPermissionDenied`)
    - Disk full scenarios (should exit with `cfg.StatusDiskFull`)
    - Backup directory creation failure (should exit with `cfg.StatusFailedToCreateBackupDirectory`)
    - Configuration errors (should exit with `cfg.StatusConfigError`)
    - Panic recovery scenarios
- `TestCreateBackupWithCleanup`: Tests backup creation with resource cleanup
  - Validates automatic resource cleanup functionality
  - Tests atomic operations with temporary files
  - Test cases:
    - Successful backup with cleanup verification
    - Backup failure with cleanup verification
    - No temporary files left after operations
    - Atomic file operations
- `TestCreateBackupWithContext`: Tests context-aware backup creation
  - Validates backup creation with cancellation support
  - Test cases:
    - Successful backup with context
    - Backup cancelled via context
    - Backup with timeout
    - Context cancellation at various stages
- `TestCreateBackupWithContextAndCleanup`: Tests context-aware backup with cleanup
  - Validates most robust backup creation functionality
  - Combines context support with resource cleanup
  - Test cases:
    - Successful backup with context and cleanup
    - Cancelled backup with proper cleanup
    - Timeout scenarios with cleanup verification
    - No resource leaks on cancellation
- `TestResourceManager`: Tests resource management functionality
  - Validates thread-safe resource tracking
  - Tests automatic cleanup mechanisms
  - Test cases:
    - Basic resource registration and cleanup
    - Thread-safe concurrent access
    - Cleanup of both files and directories
    - Error-resilient cleanup (continues on individual failures)
    - Cleanup warnings logged to stderr
- `TestBackupError`: Tests structured error handling
  - Validates BackupError functionality
  - Test cases:
    - Error creation with message and status code
    - Error interface implementation
    - Status code extraction
    - Error message formatting
- `TestIsDiskFullError`: Tests enhanced disk space detection
  - Validates disk full error detection
  - Test cases:
    - Various disk full error messages
    - Case-insensitive matching
    - Multiple disk space indicators
    - Non-disk-full errors (should return false)
    - Nil error handling
- `TestCompareFiles`: Tests file comparison
  - Validates byte-by-byte file comparison
  - Test cases:
    - Identical files
    - Different files
    - Files of different sizes
    - Empty files
    - Large files
    - Files with special characters
- `TestConfigurationDiscovery`: Tests configuration file discovery
  - Tests multiple configuration files with different precedence
  - Tests environment variable override behavior
  - Tests hard-coded default path behavior
  - Tests missing configuration files handling
  - Tests invalid configuration file handling
  - Tests configuration merging with defaults
  - Tests status code configuration precedence and merging
- `TestStatusCodeConfiguration`: Tests status code configuration
  - Validates status code loading from YAML
  - Tests status code defaults
  - Tests status code precedence with multiple configuration files
  - Tests invalid status code values handling
  - Test cases:
    - Default status codes (should match immutable specification defaults)
    - Custom status codes from configuration file
    - Status code precedence with multiple files
    - Invalid status code values (non-integer)
    - Missing status code fields (should use defaults)

### Output Formatting Tests
**Implementation**: `*_test.go` files
**Requirements**:
- `TestOutputFormatter`: Tests output formatter functionality
  - Validates printf-style formatting with various inputs
  - Tests ANSI color code support
  - Test cases:
    - Basic format string application
    - Format strings with ANSI color codes
    - Format strings with special characters
    - Invalid format strings (should fall back to safe defaults)
    - Empty format strings
    - Format strings with multiple parameters
- `TestFormatCreatedBackup`: Tests backup creation message formatting
  - Validates format string application for successful backup messages
  - Test cases:
    - Default format string
    - Custom format string with colors
    - Format string with special characters
    - Various path lengths and characters
- `TestFormatIdenticalBackup`: Tests identical file message formatting
  - Validates format string application for identical file messages
  - Test cases:
    - Default format string
    - Custom format string with highlighting
    - Format string with symbols and colors
    - Various path formats
- `TestFormatListBackup`: Tests backup listing entry formatting
  - Validates format string application for backup list entries
  - Test cases:
    - Default format string with two parameters
    - Custom format string with color coding
    - Format string with timestamp formatting
    - Various path and time combinations
- `TestFormatConfigValue`: Tests configuration value display formatting
  - Validates format string application for configuration display
  - Test cases:
    - Default format string with three parameters
    - Custom format string with highlighting
    - Format string with source emphasis
    - Various configuration name/value combinations
- `TestFormatDryRunBackup`: Tests dry-run message formatting
  - Validates format string application for dry-run messages
  - Test cases:
    - Default format string
    - Custom format string with warning indicators
    - Format string with visual emphasis
    - Various path formats
- `TestFormatError`: Tests error message formatting
  - Validates format string application for error messages
  - Test cases:
    - Default format string
    - Custom format string with error highlighting
    - Format string with symbols and colors
    - Various error message types
- `TestPrintFunctions`: Tests direct printing functions
  - Validates output to stdout and stderr
  - Test cases:
    - PrintCreatedBackup outputs to stdout
    - PrintIdenticalBackup outputs to stdout
    - PrintListBackup outputs to stdout
    - PrintConfigValue outputs to stdout
    - PrintDryRunBackup outputs to stdout
    - PrintError outputs to stderr
    - Output matches formatted strings
- `TestFormatStringConfiguration`: Tests format string configuration loading
  - Validates format string loading from YAML
  - Tests format string defaults
  - Tests format string precedence with multiple configuration files
  - Test cases:
    - Default format strings (should match immutable specification defaults)
    - Custom format strings from configuration file
    - Format string precedence with multiple files
    - Invalid format strings (should use safe defaults)
    - Missing format string fields (should use defaults)
    - Format strings with ANSI escape codes
    - Format strings with special characters
- `TestFormatStringValidation`: Tests format string validation
  - Validates printf-style format string compatibility
  - Test cases:
    - Valid format strings with correct parameter counts
    - Invalid format strings with wrong parameter counts
    - Format strings with unsupported format specifiers
    - Format strings with malformed syntax
    - Empty or nil format strings
    - Format strings with escape sequences

### Template Formatting Tests
**Implementation**: `*_test.go` files
**Requirements**:
- `TestTemplateFormatter`: Tests template formatter functionality
  - Validates template-based formatting with various inputs
  - Tests both Go text/template syntax and %{name} placeholder syntax
  - Test cases:
    - Basic template string application with {{.name}} syntax
    - Placeholder formatting with %{name} syntax
    - Template strings with ANSI color codes
    - Template strings with conditional logic
    - Invalid template strings (should fall back to safe defaults)
    - Empty template strings
    - Template strings with multiple parameters
    - Regex pattern integration with template formatting
- `TestFormatWithTemplate`: Tests Go text/template integration
  - Validates template application with named regex groups
  - Test cases:
    - Valid regex patterns with named groups
    - Template strings with {{.name}} syntax
    - Complex template logic with conditionals
    - Invalid regex patterns (should return error)
    - No regex matches (should return error)
    - Invalid template syntax (should return error)
    - Template execution errors
- `TestFormatWithPlaceholders`: Tests placeholder replacement
  - Validates %{name} placeholder replacement functionality
  - Test cases:
    - Basic placeholder replacement
    - Multiple placeholders in single string
    - Unmatched placeholders (should be left intact)
    - Empty placeholder names
    - Placeholders with special characters
    - ANSI color codes in placeholder values
    - Nested placeholder-like strings
- `TestTemplateCreatedBackup`: Tests backup creation message template formatting
  - Validates template string application for successful backup messages
  - Test cases:
    - Default template string with path extraction
    - Custom template string with filename and timestamp extraction
    - Template string with ANSI color codes
    - Backup paths with notes
    - Backup paths without notes
    - Invalid backup path formats (should fall back gracefully)
- `TestTemplateIdenticalBackup`: Tests identical file message template formatting
  - Validates template string application for identical file messages
  - Test cases:
    - Default template string with path extraction
    - Custom template string with rich backup information
    - Template string with conditional formatting based on extracted data
    - Backup paths with and without notes
    - Various backup filename formats
- `TestTemplateListBackup`: Tests backup listing entry template formatting
  - Validates template string application for backup list entries
  - Test cases:
    - Default template string with path and time parameters
    - Custom template string with extracted filename and timestamp data
    - Template string with note extraction and display
    - Various timestamp formats
    - Backup paths with special characters
    - Template formatting with missing data (graceful degradation)
- `TestTemplateConfigValue`: Tests configuration value display template formatting
  - Validates template string application for configuration display
  - Test cases:
    - Default template string with three parameters
    - Custom template string with conditional formatting based on source
    - Template string with value type detection
    - Various configuration name/value combinations
    - Source highlighting and emphasis
- `TestTemplateDryRunBackup`: Tests dry-run message template formatting
  - Validates template string application for dry-run messages
  - Test cases:
    - Default template string with path extraction
    - Custom template string with planned backup information
    - Template string with filename and timestamp extraction
    - Various planned backup path formats
- `TestTemplateError`: Tests error message template formatting
  - Validates template string application for error messages
  - Test cases:
    - Default template string with message parameter
    - Custom template string with operation context
    - Template string with error categorization
    - Various error message types
    - Operation context integration
- `TestTemplateStringConfiguration`: Tests template string configuration loading
  - Validates template string loading from YAML
  - Tests template string defaults
  - Tests template string precedence with multiple configuration files
  - Test cases:
    - Default template strings (should match immutable specification defaults)
    - Custom template strings from configuration file
    - Template string precedence with multiple files
    - Invalid template strings (should use safe defaults)
    - Missing template string fields (should use defaults)
    - Template strings with Go text/template syntax
    - Template strings with %{name} placeholder syntax
    - Template strings with ANSI escape codes
- `TestRegexPatternConfiguration`: Tests regex pattern configuration loading
  - Validates regex pattern loading from YAML
  - Tests regex pattern defaults
  - Tests regex pattern precedence with multiple configuration files
  - Test cases:
    - Default regex patterns (should match immutable specification defaults)
    - Custom regex patterns from configuration file
    - Regex pattern precedence with multiple files
    - Invalid regex patterns (should use safe defaults)
    - Missing regex pattern fields (should use defaults)
    - Named capture group validation
    - Regex pattern compilation and performance
- `TestTemplateRegexIntegration`: Tests integration between templates and regex patterns
  - Validates data extraction and template application workflow
  - Test cases:
    - Backup filename parsing with template formatting
    - Timestamp parsing with template formatting
    - Configuration line parsing with template formatting
    - Complex data extraction scenarios
    - Error handling when regex patterns don't match
    - Fallback behavior for template formatting failures
    - Performance with large datasets

### Integration Tests
**Implementation**: `*_test.go` files
**Requirements**:
- `TestDefaultBackupCmd`: Tests default backup behavior
  - Validates backup creation with various notes
  - Tests status code exit behavior in full application context
  - Tests enhanced error handling in real scenarios
  - **Updated for printf-style formatting**:
    - Tests output formatting with default format strings
    - Tests output formatting with custom format strings
    - Validates ANSI color code rendering in terminal output
    - Tests format string configuration loading and application
  - **Updated for template-based formatting**:
    - Tests template formatting with default template strings
    - Tests template formatting with custom template strings
    - Validates regex pattern integration with template formatting
    - Tests template string configuration loading and application
    - Validates data extraction and rich formatting capabilities
  - Test cases:
    - Backup with note (should exit with configured `status_created_backup` and use `format_created_backup`)
    - Backup without note (should exit with configured `status_created_backup` and use `format_created_backup`)
    - Backup of identical file (should exit with configured `status_file_is_identical_to_existing_backup` and use `format_identical_backup`)
    - Backup of modified file (should exit with configured `status_created_backup` and use `format_created_backup`)
    - Backup with custom status code configuration
    - Backup with custom format string configuration
    - Error scenarios with proper status codes and formatted error messages
- `TestListFlag`: Tests list flag functionality
  - Validates --list flag behavior
  - **Updated for printf-style formatting**:
    - Tests backup listing with default format strings
    - Tests backup listing with custom format strings
    - Validates color-coded output for enhanced readability
  - **Updated for template-based formatting**:
    - Tests template formatting with default template strings
    - Tests template formatting with custom template strings
    - Validates regex pattern integration with template formatting
    - Tests template string configuration loading and application
    - Validates data extraction and rich formatting capabilities
  - Test cases:
    - List with existing backups (using `format_list_backup`)
    - List with no backups
    - List with invalid file path (using `format_error`)
    - List with custom format string configuration
- `TestConfigFlag`: Tests config flag functionality
  - Validates --config flag behavior
  - **Updated for printf-style formatting**:
    - Tests configuration display with default format strings
    - Tests configuration display with custom format strings
    - Validates format string configuration display
  - **Updated for template-based formatting**:
    - Tests template formatting with default template strings
    - Tests template formatting with custom template strings
    - Validates regex pattern integration with template formatting
    - Tests template string configuration loading and application
    - Validates data extraction and rich formatting capabilities
  - Test cases:
    - Display config with default values only (including status codes and format strings)
    - Display config with values from single configuration file
    - Display config with values from multiple configuration files
    - Display config with `BKPFILE_CONFIG` environment variable set
    - Display config with hard-coded default path when environment variable not set
    - Display config with invalid configuration files (error handling using `format_error`)
    - Display config with custom status code values
    - Display config with custom format string values
    - Verify application exits after displaying configuration
    - Verify format string configuration is displayed with proper formatting
- `TestCmdArgsValidation`: Tests command-line arguments
  - Validates command-line interface
  - **Updated for printf-style formatting**:
    - Tests error message formatting for invalid arguments
  - **Updated for template-based formatting**:
    - Tests template formatting with default template strings
    - Tests template formatting with custom template strings
    - Validates regex pattern integration with template formatting
    - Tests template string configuration loading and application
    - Validates data extraction and rich formatting capabilities
  - Test cases:
    - Invalid flag combinations (using `format_error`)
    - Missing file path (using `format_error`)
    - Invalid file path (using `format_error`)
    - Config flag with other arguments (should be ignored)
- `TestDryRun`: Tests dry-run mode
  - Validates dry-run mode behavior
  - **Updated for printf-style formatting**:
    - Tests dry-run output with default format strings
    - Tests dry-run output with custom format strings
  - **Updated for template-based formatting**:
    - Tests template formatting with default template strings
    - Tests template formatting with custom template strings
    - Validates regex pattern integration with template formatting
    - Tests template string configuration loading and application
    - Validates data extraction and rich formatting capabilities
  - Test cases:
    - Dry run with identical file (using `format_identical_backup`)
    - Dry run with modified file (using `format_dry_run_backup`)
    - Dry run with list flag (using `format_list_backup`)
    - Dry run with resource cleanup verification
    - Dry run with custom format string configuration
- `TestFormatStringIntegration`: Tests format string configuration in full application context
  - Tests all operations with custom format string configurations
  - Tests format string precedence with multiple configuration files
  - Tests format string error handling and fallbacks
  - Test cases:
    - Backup creation with custom format strings
    - List operation with custom format strings
    - Configuration display with custom format strings
    - Error handling with custom error format strings
    - Format string precedence with multiple configuration files
    - Invalid format strings falling back to safe defaults
    - ANSI color code rendering in various terminal environments
    - Format string validation and error handling
- `TestConfigurationIntegration`: Tests configuration discovery in full application context
  - Tests backup operations with custom configuration paths
  - Tests environment variable override in real scenarios
  - Tests hard-coded default path behavior
  - Tests configuration precedence with actual file operations
  - Tests status code configuration in real application scenarios
  - Test cases:
    - Backup creation with `BKPFILE_CONFIG` set
    - List operation with multiple configuration files
    - Error handling with invalid configuration paths
    - Dry-run with custom configuration discovery
    - Configuration display with various environment setups
    - Status code behavior with custom configuration
    - Application exit codes with different error conditions
- `TestStatusCodeIntegration`: Tests status code configuration in full application context
  - Validates application exit codes match configuration
  - Tests status code behavior with various error conditions
  - Test cases:
    - Application exits with correct status code for successful backup
    - Application exits with correct status code for identical file
    - Application exits with correct status code for file not found
    - Application exits with correct status code for permission denied
    - Application exits with correct status code for invalid file type
    - Status code configuration from multiple files with precedence
    - Default status codes when no configuration provided
- `TestResourceCleanupIntegration`: Tests resource cleanup in full application context
  - Validates resource cleanup across entire application workflow
  - Tests cleanup with various error scenarios
  - Test cases:
    - Successful operations with cleanup verification
    - Failed operations with cleanup verification
    - Interrupted operations with cleanup verification
    - No temporary files left in any scenario
- `TestTemplateFormattingIntegration`: Tests template formatting configuration in full application context
  - Tests all operations with custom template string configurations
  - Tests template string precedence with multiple configuration files
  - Tests template string error handling and fallbacks
  - Tests regex pattern integration with template formatting
  - Test cases:
    - Backup creation with custom template strings and regex patterns
    - List operation with custom template strings and data extraction
    - Configuration display with custom template strings
    - Error handling with custom error template strings
    - Template string precedence with multiple configuration files
    - Invalid template strings falling back to safe defaults
    - Regex pattern matching and data extraction in various scenarios
    - Template formatting with missing or incomplete data
    - ANSI color code rendering in template-formatted output
    - Template validation and error handling
    - Performance with complex template strings and large datasets
- `TestRegexPatternIntegration`: Tests regex pattern configuration in full application context
  - Tests regex pattern loading and compilation
  - Tests named capture group extraction and usage
  - Tests pattern precedence with multiple configuration files
  - Test cases:
    - Backup filename parsing with custom regex patterns
    - Timestamp parsing with custom regex patterns
    - Configuration line parsing with custom regex patterns
    - Invalid regex patterns falling back to safe defaults
    - Regex pattern precedence with multiple configuration files
    - Named capture group validation and extraction
    - Performance with complex regex patterns and large datasets
    - Error handling for malformed regex patterns

### Linting and Code Quality Tests
**Implementation**: `Makefile`, CI/CD pipeline
**Requirements**:
- `make lint`: Runs revive linter
  - Validates all Go code passes linting standards
  - Checks error handling compliance
  - Validates code style and formatting
  - Test cases:
    - All source files pass revive checks
    - No unhandled errors
    - Proper function and variable naming
    - Adequate documentation
- Code quality validation:
  - All `fmt.Printf`, `fmt.Fprintf` return values checked
  - All file operations handle errors appropriately
  - Consistent error handling patterns
  - Proper resource cleanup in all code paths

### Performance and Stress Tests
**Implementation**: `*_test.go` files with benchmarks
**Requirements**:
- `BenchmarkCreateBackup`: Benchmarks backup creation performance
  - Tests performance with various file sizes
  - Measures resource cleanup overhead
  - Validates memory usage patterns
- `BenchmarkResourceManager`: Benchmarks resource management performance
  - Tests performance with many temporary resources
  - Measures cleanup time with large resource lists
  - Validates thread-safe performance
- Stress tests:
  - Concurrent backup operations
  - Large file handling
  - Many temporary resources
  - Resource cleanup under load

## Test Approach
**Implementation**: `*_test.go` files
**Requirements**:
- Uses temporary directories for testing
- Simulates user environment with test files
- Tests both dry-run and actual execution modes
- Verifies correct behavior for edge cases and error conditions
- Uses `CreateBackupWithTime` for consistent timestamps in tests
- Tests path handling for both absolute and relative paths
- Tests file comparison with various file types and sizes
- Verifies correct exit behavior when files are identical
- Tests flag-based command structure
- Validates proper reporting of existing backup names
- Tests environment variable handling with various configurations
- Creates multiple temporary configuration files for precedence testing
- Tests home directory expansion and path resolution
- Tests configuration discovery error conditions and edge cases
- Validates configuration display output format and source tracking
- Tests application exit behavior after configuration display
- Tests status code configuration loading and application
- Validates application exit codes match configured values
- Tests status code behavior with various error conditions and scenarios
- Creates test configuration files with custom status code values
- Verifies status code precedence with multiple configuration files
- Tests resource cleanup in all scenarios including failures
- Validates context cancellation and timeout handling
- Tests panic recovery and error resilience
- Verifies no resource leaks in any test scenario
- Tests atomic operations and data integrity
- Validates enhanced error detection and handling

## Test Environment
- Uses Go's testing package
- Leverages temporary directories for file operations
- Mocks time functions for consistent testing
- Simulates file system operations
- Tests on both macOS and Linux platforms
- Mocks environment variables for configuration testing
- Creates temporary configuration files with various content
- Uses context with timeouts for cancellation testing
- Simulates disk full and permission denied scenarios
- Tests with various file sizes and types
- Validates cleanup in all test scenarios

## Test Coverage Requirements
- All core functions must have unit tests
- All command-line operations must have integration tests
- Edge cases must be covered
- Error conditions must be tested
- Platform-specific behaviors must be verified
- File system operations must be tested thoroughly
- Configuration display functionality must be comprehensively tested
- Environment variable handling must be verified
- Status code configuration must be thoroughly tested
- Application exit codes must be validated for all conditions
- Status code precedence and merging must be tested
- Default status code behavior must be verified
- **Output formatting functionality must be comprehensively tested**
- **Format string configuration must be thoroughly tested**
- **Printf-style formatting must be validated for all output types**
- **ANSI color code support must be verified**
- **Format string validation and error handling must be tested**
- **Format string precedence and merging must be tested**
- **Default format string behavior must be verified**
- **Text highlighting and structure formatting must be validated**
- **Template-based formatting functionality must be comprehensively tested**
- **Template string configuration must be thoroughly tested**
- **Go text/template syntax must be validated for all output types**
- **Placeholder syntax (%{name}) must be validated for all output types**
- **Regex pattern integration must be verified**
- **Named capture group extraction must be tested**
- **Template string validation and error handling must be tested**
- **Template string precedence and merging must be tested**
- **Default template string behavior must be verified**
- **Data extraction and rich formatting capabilities must be validated**
- **Template formatting fallback behavior must be tested**
- Resource cleanup must be tested in all scenarios
- Context cancellation and timeout handling must be verified
- Enhanced error handling must be thoroughly tested
- Panic recovery must be validated
- Atomic operations must be tested
- Thread safety must be verified
- Performance characteristics must be measured
- Memory usage patterns must be validated

## Running Tests
```bash
# Run all tests
go test ./internal/bkpfile -v

# Run tests with coverage
go test ./internal/bkpfile -v -cover

# Run specific test categories
go test ./internal/bkpfile -v -run TestResourceManager
go test ./internal/bkpfile -v -run TestCreateBackupWithCleanup
go test ./internal/bkpfile -v -run TestCreateBackupWithContext
go test ./internal/bkpfile -v -run TestOutputFormatter
go test ./internal/bkpfile -v -run TestFormatString

# Run benchmarks
go test ./internal/bkpfile -v -bench=.

# Run linting
make lint

# Run all quality checks
make test
```

## Test Data Management
- Test files are created in temporary directories
- Test data is cleaned up after tests
- Test files use consistent naming patterns
- Test data covers various file sizes and types
- Test data includes special characters and edge cases
- Test configuration files cover various YAML structures and edge cases
- **Test configuration files include various format string configurations**
- **Test data includes format strings with ANSI color codes**
- **Test data includes invalid format strings for error handling**
- **Test data covers format string precedence scenarios**
- **Test data includes template strings with Go text/template syntax**
- **Test data includes template strings with %{name} placeholder syntax**
- **Test data includes regex patterns with named capture groups**
- **Test data includes invalid template strings for error handling**
- **Test data includes invalid regex patterns for error handling**
- **Test data covers template string precedence scenarios**
- **Test data covers regex pattern precedence scenarios**
- **Test data includes complex data extraction scenarios**
- Temporary resources are tracked and verified for cleanup
- Test data includes scenarios for context cancellation
- Test files simulate various error conditions
- Test data covers atomic operation scenarios

## Continuous Integration Requirements
- All tests must pass before code merge
- Linting must pass before code merge
- Code coverage must meet minimum thresholds
- Performance benchmarks must not regress
- Resource cleanup must be verified in CI environment
- Tests must run on multiple platforms
- Memory leak detection must be performed
- Static analysis must pass
- **Format string validation must pass in CI environment**
- **Output formatting tests must pass on all supported platforms**
- **ANSI color code rendering must be tested in CI environment**
- **Template string validation must pass in CI environment**
- **Template formatting tests must pass on all supported platforms**
- **Regex pattern compilation must be tested in CI environment**
- **Data extraction and template integration must be validated in CI** 